@startuml US2003_SD

title [US2003 - Sequence Diagram]

box System #LightBlue
participant "<<presentation>>\n:GenerateRequirementsTemplateFileUI" as UI
control "<<application>>\n:GenerateRequirementsTemplateFileController" as CTRL
participant "<<service>>\n:AuthorizationService" as AuthSvc
participant "<<service>>\n:CustomerManagementService" as CustomerManagement
database "<<repository>>\n:CustomerRepository" as CustomerRepository
participant "<<domain>>\n:Customer" as Customer
participant "<<service>>\n:JobOpeningManagementService" as JobManagement
participant "<<service>>\n:JobOpeningListDTOService" as JobOpeningListDTO
database "<<repository>>\n:JobOpeningRepository" as JobOpeningRepository
participant "<<domain>>\n:JobOpening" as JobOpening
participant "<<service>>\n:RequirementsTemplateManagerService" as Manager
database "<<repository>>\n:RequirementSpecificationRepository" as ReqRep
end box

box Plugin #LightPink
participant "<<Plugin>>\n:RequirementsTemplatePlugin" as Plugin
participant "<<Parser/Interpreter>>\n:RequirementsTemplateParser" as Parser
end box


activate UI

UI -> CTRL : create()
activate CTRL
deactivate CTRL

UI -> CTRL : getJobOpeningList()
activate CTRL

    CTRL -> AuthSvc : loggedinUserWithPermissions(BaseRole.CUSTOMER_MANAGER)
    activate AuthSvc
    deactivate AuthSvc

    CTRL -> CustomerManagement : getAssignedCustomerCodesList(username)
    activate CustomerManagement

        CustomerManagement -> CustomerRepository : getCustomersByUsername(username)
        note right: Username is the Customer\n Manager's email
        activate CustomerRepository
        deactivate CustomerRepository

        loop for all codes
            CustomerManagement -> Customer : customerCode()
            activate Customer
            deactivate Customer
        end loop

    deactivate CustomerManagement

    CTRL -> JobManagement : getJobOpeningsFromCustomerCodes(assignedCustomerCodesList)
    activate JobManagement
        loop for each code
        JobManagement -> JobOpeningRepository : getJobOpeningListMatchingCustomerCode(customerCode)
        activate JobOpeningRepository
        deactivate JobOpeningRepository
        end loop
    deactivate JobManagement

CTRL -> JobOpeningListDTO : convertToDTO(jobOpeningList)
activate JobOpeningListDTO

    loop for each JobOpening
        JobOpeningListDTO -> JobOpening : toDTO()
        activate JobOpening
        deactivate JobOpening
    end loop
deactivate JobOpeningListDTO

CTRL --> UI : jobOpeningListDTO
deactivate CTRL


UI -> CTRL : exportTemplateFile(jobOpeningDTO)

'get job positions/plugins
activate CTRL

CTRL -> Manager : getRequirementFromJobOpening(jobOpeningDTO)
activate Manager

Manager -> ReqRep : requirementSpecificationFromDTO(jobOpeningDTO)
deactivate Manager
activate ReqRep

ReqRep -[#lightblue]> ReqRep
deactivate ReqRep


    CTRL -> Manager : generateNewTemplate(requirementSpecification)
    activate Manager

        Manager -> Plugin : newRequirementsSpecificationsTemplate()
    activate Plugin

        Plugin -> Plugin : generateFile()

        Plugin -> Parser : checkFileSyntax(templateFile)
        note left: Along with the requirements\n template grammar.

        activate Parser
        deactivate Parser

        Plugin -> Plugin : export()
       Plugin --> Manager : confirmation
    deactivate Plugin

    Manager --> CTRL : confirmation
    deactivate Manager

    CTRL --> UI : confirmation
deactivate CTRL

deactivate UI

@enduml