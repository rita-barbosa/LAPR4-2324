@startuml
'https://plantuml.com/sequence-diagram

title US1015 - Sequence Diagram

autonumber

actor "Customer Manager" as USER
participant ":VerifyRequirementUI" as UI <<presentation>>
participant ":VerifyRequirementController" as CTRL <<application>>
participant ":AuthorizationService" as AUTHZ <<service>>
database ":JobOpeningRepository" as JO_REPO <<repository>>
database ":ApplicationRepository" as A_REPO <<repository>>
participant ":RequirementSpecificationPlugin" as RSP <<interface>>
participant ":Application" as A <<domain>>


activate USER

USER -> UI : asks to verify requirements of applications
activate UI

UI -> CTRL**: create

UI -> CTRL : getJobOpeningList()
activate CTRL

ref over CTRL
**[ref1]:** Check **sequence-diagram-get-job-openings**
in the folder **team-decisions**
end ref

CTRL --> UI: jobOpeningListDTO
deactivate CTRL

UI --> USER : displays the job openings and asks to select one
deactivate UI


USER -> UI : selects job opening
activate UI

    UI -> CTRL: verifyAvailableRequirements(jobOpeningDto)
    activate CTRL

    CTRL -> AUTHZ:  ensureAuthenticatedUserHasAnyOf(roles)
    activate AUTHZ
    deactivate AUTHZ

    CTRL -> JO_REPO: ofIdentity(jobReference)
    activate JO_REPO

    JO_REPO --> CTRL: jobOpening
    deactivate JO_REPO

    CTRL -> CTRL : verifyRequirementsOfApplications(jobReference)
    activate CTRL

        CTRL -> A_REPO: applicationsForJobOpeningWithRequirements(jobReference)
        activate A_REPO
        A_REPO --> CTRL: applications
        deactivate A_REPO

        loop for each application
             CTRL -> RSP: evaluateRequirementsFile(requirementAnswer)
             activate RSP

             RSP --> CTRL: result
             deactivate RSP

             CTRL -> A: updateRequirementResult(result)
             activate A
             deactivate A

             CTRL -> A_REPO: save(application)
             activate A_REPO
             deactivate A_REPO
        end loop

    CTRL --> CTRL:
    deactivate CTRL

CTRL --> UI: success
deactivate CTRL

UI --> USER: displays success

deactivate USER


@enduml