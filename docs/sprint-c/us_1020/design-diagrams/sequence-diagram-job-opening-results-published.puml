@startuml
autonumber

title US1020 - Send Email to Candidate and Customer


participant ":EventPublisher" as EP <<application>>
participant ":JobOpeningResultsPublished\nWatchDog" as WD <<application>>
participant ":SendEmailOnJobOpening\nResultsPublishedController" as CTRL_EVENT <<application>>
database ":CustomerRepository" as C_REPO
participant ":FollowUpConnectionService" as ENTITY


 -> EP : publish()
activate EP

EP -> WD: onEvent()
activate WD

WD -> CTRL_EVENT**: create()
activate CTRL_EVENT

note right
Upon creation of controller
a connection will be established
with the FollowUp server
end note

CTRL_EVENT -> ENTITY: connectToServer()
activate ENTITY

ENTITY --> CTRL_EVENT : success
deactivate ENTITY
deactivate CTRL_EVENT

WD -> CTRL_EVENT: sendEmail(jobOpeningResultsPublishedEvent)
activate CTRL_EVENT

CTRL_EVENT -> C_REPO: getCustomerByCustomerCode(companyCode)
activate C_REPO
deactivate C_REPO


CTRL_EVENT -> ENTITY: sendEmail(customerManagerEmail, customerEmail,\n topic, emailBody)
activate ENTITY


deactivate ENTITY

deactivate WD
deactivate EP
deactivate CTRL_EVENT
'deactivate EMS


@enduml


